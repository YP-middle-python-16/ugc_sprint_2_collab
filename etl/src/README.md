# ETL

## Назначение
Сервис необходим для пополнения БД ClickHouse событиями по просмотру фильмов пользователем (пишется каждая секунда просмотра).

## Архитектура
Кафка используется как хранилище и транспорт до ETL. 
Для того, чтобы использовать прелести кафки типа консьюмер-групп и доступа к оффсетам, был развернут кластер из 2х нод. 
Сервис ETL вычитывает данные из кафки пачками, заданными в консьюмере параметром `max_poll_records` (по умолчанию 500).
Каждый топик кафки регистрирует события для сущности, 
в рамках ETL означает, что для одного топика будет создана таблица в БД ClickHouse.
Трансформация данных в сервисе собирает сообщения из кафки в словарь вида "имя_топика": "список сообщений", 
чтобы удобно загрузить вычитанный батч в БД одним запросом.
При необходимости, ETL-сервис создает БД и таблицы, после чего загружает в них данные.
Структура ClickHouse - 4 ноды и 1 Zookeeper.
Структура Kafka - 2 ноды и 2 Zookeeper.